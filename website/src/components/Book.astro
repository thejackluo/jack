---
interface Props {
  title: string;
  author: string;
  category: string;
  progress: number;
  score: number;
  pageCount: number;
  color: string;
  gradient?: {
    start: string;
    end: string;
  };
  index: number;
}

const { title, author, category, progress, score, pageCount, color, gradient, index } = Astro.props;

// Calculate spine width based on page count (thicker books have wider spines)
const spineWidth = Math.max(30, Math.min(60, pageCount / 10));
const bookWidth = 160;
const bookHeight = 240;

// Use gradient if available, otherwise solid color
const coverGradient = gradient
  ? `linear-gradient(135deg, ${gradient.start}, ${gradient.end})`
  : color;

const backGradient = gradient
  ? `linear-gradient(135deg, ${gradient.end}, ${gradient.start})`
  : color;
---

<div
  class="book-container"
  data-index={index}
  style={`--spine-width: ${spineWidth}px; --book-width: ${bookWidth}px; --book-height: ${bookHeight}px;`}
>
  <div class="book">
    <div class="book-spine" style={`background: linear-gradient(to bottom, ${color}, ${gradient?.end || color})`}>
      <span class="spine-text">{title}</span>
    </div>
    <div class="book-cover glassmorphic" style={`background: ${coverGradient}`}>
      <div class="book-content">
        <h3 class="book-title">{title}</h3>
        <p class="book-author">{author}</p>
        <p class="book-category">{category}</p>
        <div class="progress-container">
          <div class="progress-label">Progress: {progress}%</div>
          <div class="progress-bar">
            <div class="progress-fill" style={`width: ${progress}%`}></div>
          </div>
        </div>
        {score > 0 && (
          <div class="score">
            <span class="score-label">Rating:</span>
            <span class="stars">{'‚≠ê'.repeat(score)}</span>
          </div>
        )}
        <div class="page-count">{pageCount} pages</div>
      </div>
    </div>
    <div class="book-pages"></div>
    <div class="book-back glassmorphic" style={`background: ${backGradient}`}>
      <div class="book-back-content">
        <p class="back-text">"{title}"</p>
        <p class="back-author">by {author}</p>
      </div>
    </div>
  </div>
</div>

<style>
  .book-container {
    position: relative;
    width: var(--spine-width);
    height: var(--book-height);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    margin: 0;
  }

  .book-container.spread-left {
    transform: translateX(-80px);
  }

  .book-container.spread-right {
    transform: translateX(80px);
  }

  .book-container.selected {
    z-index: 100;
    width: var(--book-width);
  }

  .book {
    width: var(--book-width);
    height: var(--book-height);
    position: absolute;
    left: calc(-1 * (var(--book-width) - var(--spine-width)) / 2);
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    transform: rotateY(90deg);
  }

  .book-container:hover .book {
    transform: rotateY(85deg);
  }

  .book-container.selected .book {
    transform: rotateY(0deg);
  }

  .book-container.selected:hover .book {
    transform: rotateY(-5deg);
  }

  .book-cover,
  .book-back,
  .book-spine,
  .book-pages {
    position: absolute;
    backface-visibility: hidden;
  }

  .book-cover {
    width: var(--book-width);
    height: var(--book-height);
    transform: rotateY(0deg) translateZ(calc(var(--spine-width) / 2));
    border-radius: 8px;
    padding: 20px;
    box-shadow:
      0 10px 30px rgba(0, 0, 0, 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .glassmorphic {
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .book-content {
    color: white;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    height: 100%;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .book-title {
    font-size: 16px;
    font-weight: bold;
    margin: 0;
    line-height: 1.2;
  }

  .book-author {
    font-size: 12px;
    opacity: 0.9;
    margin: 0;
  }

  .book-category {
    font-size: 10px;
    opacity: 0.7;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin: 0;
  }

  .progress-container {
    margin-top: auto;
  }

  .progress-label {
    font-size: 11px;
    margin-bottom: 4px;
  }

  .progress-bar {
    height: 8px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #00ffff, #00ccff);
    transition: width 0.3s ease;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
  }

  .score {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
  }

  .stars {
    font-size: 12px;
  }

  .page-count {
    font-size: 10px;
    opacity: 0.6;
  }

  .book-back {
    width: var(--book-width);
    height: var(--book-height);
    transform: rotateY(180deg) translateZ(calc(var(--spine-width) / 2));
    border-radius: 8px;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow:
      0 10px 30px rgba(0, 0, 0, 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .book-back-content {
    color: white;
    text-align: center;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
  }

  .back-text {
    font-size: 14px;
    font-style: italic;
    margin-bottom: 10px;
  }

  .back-author {
    font-size: 12px;
    opacity: 0.8;
  }

  .book-spine {
    width: var(--spine-width);
    height: var(--book-height);
    left: calc((var(--book-width) - var(--spine-width)) / 2);
    transform: rotateY(-90deg) translateZ(calc(var(--book-width) / 2));
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    box-shadow:
      inset -2px 0 5px rgba(0, 0, 0, 0.3),
      inset 2px 0 5px rgba(255, 255, 255, 0.1);
  }

  .spine-text {
    writing-mode: vertical-rl;
    text-orientation: mixed;
    font-size: 12px;
    font-weight: bold;
    color: white;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
    padding: 10px 5px;
    text-align: center;
  }

  .book-pages {
    width: var(--spine-width);
    height: var(--book-height);
    left: calc((var(--book-width) - var(--spine-width)) / 2);
    transform: rotateY(90deg) translateZ(calc(var(--book-width) / 2));
    background-image: repeating-linear-gradient(
      90deg,
      #f8f8f8,
      #f8f8f8 1px,
      #e8e8e8 1px,
      #e8e8e8 2px
    );
    border-left: 2px solid rgba(0, 0, 0, 0.2);
    border-right: 2px solid rgba(0, 0, 0, 0.2);
    border-radius: 2px;
  }
</style>
